<template>
  <div class="article_div">
    <div class="article_background">
      <div class="article_header">
        <h1 class="article_title">{{ get_ArticlePage.title }}</h1>
        <el-image
          class="article_background_img"
          :src="get_ArticlePage.coverRequirePath"
          fit="contain"
        ></el-image>
        <div class="article_category">
          文章分类： <el-tag>{{ get_ArticlePage.category }}</el-tag>
        </div>
        <div class="article_date">
          发布日期： <el-tag>{{ get_ArticlePage.date }}</el-tag>
        </div>
        <div class="article_synopsis">
          <div class="article_synopsis_first">文章简介：</div>
          <p class="article_synopsis_second">{{ get_ArticlePage.synopsis }}</p>
        </div>
        <div class="article_fun">
          <div class="fun_guankan">
            <svg
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill="#515151"
                d="M928.842245 512.091074c0-5.006014-0.846274-9.193383-1.086751-9.691733-0.182149-2.480494-1.028423-7.001461-1.815345-9.374508-0.210801-0.590448-0.484024-1.209548-0.724501-1.799996-0.424672-1.360997-0.876973-2.691295-1.390673-3.749394-76.871785-168.137395-242.376213-281.144168-411.782507-281.144168-169.375595 0-334.865697 112.902396-411.388535 280.130072-0.921999 1.815345-1.572822 3.553942-1.981121 5.066389-0.181125 0.49835-0.39295 0.967024-0.558725 1.406023-1.512447 4.430916-1.542122 7.514137-1.421372 6.712889-0.710175 3.251044-1.360997 9.722432-1.360997 9.722432-0.181125 1.949398-0.181125 3.50687 0.030699 5.442966 0 0 0.649799 5.65479 0.968048 6.80294 0.090051 1.602498 0.483001 3.931542 0.951675 6.048763l-0.030699 0c0.408299 1.814322 0.968048 3.568269 1.738597 5.291516 0.393973 1.330298 0.862647 2.570545 1.270946 3.507894 76.976162 168.166047 242.436588 281.20352 411.781484 281.20352 169.436994 0 334.941422-112.945375 410.936233-279.328823 1.177825-2.177596 1.935072-4.233418 2.448772-6.018064 0.2415-0.543376 0.454348-1.027399 0.604774-1.511423 1.331321-3.872191 1.602498-7.227612 1.481747-7.227612l-0.028653 0.029676C928.027693 520.921183 928.842245 516.89959 928.842245 512.091074zM872.717993 514.146896c-0.029676 0.121773-0.091074 0.272199-0.151449 0.393973-0.090051 0.36225-0.240477 0.785899-0.332575 1.209548-68.403926 147.420561-212.830293 246.337431-360.191502 246.337431-146.997935 0-291.168476-98.642624-360.252901-246.578931-0.166799-0.5137-0.287549-0.998747-0.468674-1.481747-0.030699-0.484024-0.12075-0.876973-0.150426-1.150196-0.060375-0.300852-0.12075-0.724501-0.166799-1.088798l0-0.3776c0.166799-0.620124 0.286526-1.239224 0.347924-1.919722 0.12075-0.36225 0.211824-0.710175 0.347924-1.103124C220.132094 360.89042 364.680235 261.928524 512.041444 261.928524c147.420561 0 291.940049 99.051947 360.161826 246.322082 0.060375 0.287549 0.121773 0.530073 0.212848 0.726547 0.060375 0.2415 0.119727 0.484024 0.240477 0.740874 0.151449 1.104147 0.272199 2.192945 0.423649 2.736321C872.899118 513.028423 872.809067 513.572822 872.717993 514.146896zM512.041444 373.060601c-76.598562 0-138.954749 62.325487-138.954749 138.939399 0 76.598562 62.356187 138.954749 138.954749 138.954749 76.598562 0 138.954749-62.356187 138.954749-138.954749C650.996193 435.386088 588.640006 373.060601 512.041444 373.060601zM512.041444 595.372849c-45.935192 0-83.371826-37.406958-83.371826-83.371826 0-45.950542 37.436634-83.356476 83.371826-83.356476 45.964868 0 83.373873 37.406958 83.373873 83.356476C595.414293 557.965891 558.006312 595.372849 512.041444 595.372849z"
              />
            </svg>
            <div class="article_fun_num">{{ get_ArticlePage.view }}</div>
          </div>
          <div class="fun_yishoucang" v-if="get_Favorites">
            <svg
              @click="favorite"
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill="#515151"
                d="M335.008 916.629333c-35.914667 22.314667-82.88 10.773333-104.693333-25.557333a77.333333 77.333333 0 0 1-8.96-57.429333l46.485333-198.24a13.141333 13.141333 0 0 0-4.021333-12.864l-152.16-132.586667c-31.605333-27.52-35.253333-75.648-8.234667-107.733333a75.68 75.68 0 0 1 51.733333-26.752L354.848 339.2c4.352-0.362667 8.245333-3.232 10.026667-7.594667l76.938666-188.170666c16.032-39.2 60.618667-57.92 99.52-41.461334a76.309333 76.309333 0 0 1 40.832 41.461334l76.938667 188.16c1.781333 4.373333 5.674667 7.253333 10.026667 7.605333l199.712 16.277333c41.877333 3.413333 72.885333 40.458667 69.568 82.517334a76.938667 76.938667 0 0 1-26.08 51.978666l-152.16 132.586667c-3.541333 3.082667-5.141333 8.074667-4.021334 12.853333l46.485334 198.24c9.621333 41.013333-15.36 82.336-56.138667 92.224a75.285333 75.285333 0 0 1-57.525333-9.237333l-170.976-106.24a11.296 11.296 0 0 0-12.010667 0l-170.986667 106.24z"
              />
            </svg>
            <div class="article_fun_num">{{ get_ArticlePage.favorites }}</div>
          </div>
          <div class="fun_shoucang" v-if="!get_Favorites">
            <svg
              @click="favorite"
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill="#515151"
                d="M335.008 916.629333c-35.914667 22.314667-82.88 10.773333-104.693333-25.557333a77.333333 77.333333 0 0 1-8.96-57.429333l46.485333-198.24a13.141333 13.141333 0 0 0-4.021333-12.864l-152.16-132.586667c-31.605333-27.52-35.253333-75.648-8.234667-107.733333a75.68 75.68 0 0 1 51.733333-26.752L354.848 339.2c4.352-0.362667 8.245333-3.232 10.026667-7.594667l76.938666-188.170666c16.032-39.2 60.618667-57.92 99.52-41.461334a76.309333 76.309333 0 0 1 40.832 41.461334l76.938667 188.16c1.781333 4.373333 5.674667 7.253333 10.026667 7.605333l199.712 16.277333c41.877333 3.413333 72.885333 40.458667 69.568 82.517334a76.938667 76.938667 0 0 1-26.08 51.978666l-152.16 132.586667c-3.541333 3.082667-5.141333 8.074667-4.021334 12.853333l46.485334 198.24c9.621333 41.013333-15.36 82.336-56.138667 92.224a75.285333 75.285333 0 0 1-57.525333-9.237333l-170.976-106.24a11.296 11.296 0 0 0-12.010667 0l-170.986667 106.24zM551.786667 756.032l170.976 106.24c2.624 1.621333 5.717333 2.122667 8.650666 1.408 6.410667-1.557333 10.56-8.426667 8.928-15.424l-46.485333-198.24a77.141333 77.141333 0 0 1 24.277333-75.733333L870.293333 441.706667c2.485333-2.165333 4.053333-5.312 4.330667-8.746667 0.565333-7.136-4.490667-13.173333-10.976-13.696l-199.712-16.288a75.989333 75.989333 0 0 1-64.064-47.168l-76.938667-188.16a12.309333 12.309333 0 0 0-6.538666-6.741333c-5.898667-2.496-12.725333 0.373333-15.328 6.741333l-76.949334 188.16a75.989333 75.989333 0 0 1-64.064 47.168l-199.701333 16.288a11.68 11.68 0 0 0-7.978667 4.181333 13.226667 13.226667 0 0 0 1.333334 18.261334l152.16 132.586666a77.141333 77.141333 0 0 1 24.277333 75.733334l-46.485333 198.229333a13.333333 13.333333 0 0 0 1.514666 9.877333c3.488 5.792 10.581333 7.530667 16.064 4.128l170.986667-106.229333a75.296 75.296 0 0 1 79.562667 0z"
              />
            </svg>
            <div class="article_fun_num">{{ get_ArticlePage.favorites }}</div>
          </div>
          <div class="fun_pinglun">
            <svg
              @click="toComment"
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill="#515151"
                d="M290.8 417.7c-29.7 0-53.8 24.1-53.8 53.8 0 29.7 24.1 53.8 53.8 53.8s53.8-24.1 53.8-53.8c-0.1-29.8-24.1-53.8-53.8-53.8zM512.1 417.7c-29.7 0-53.8 24.1-53.8 53.8 0 29.7 24.1 53.8 53.8 53.8 29.7 0 53.8-24.1 53.8-53.8 0-29.8-24.1-53.8-53.8-53.8zM733.4 417.7c-29.7 0-53.8 24.1-53.8 53.8 0 29.7 24.1 53.8 53.8 53.8 29.7 0 53.8-24.1 53.8-53.8 0-29.8-24.1-53.8-53.8-53.8zM512.1 104.2C229.8 104.2 0.1 264.5 0.1 461.5c0 108 67.3 207.9 185.3 275.8-2.6 10.7-8.6 27-12.5 37.8-13.8 37.9-24.7 67.9-13 92.1 5.1 10.6 14 18.4 25.1 22.1 4.2 1.4 8.3 2.1 12.7 2.1 20.6 0 46.1-15.6 99.6-50.1 20.7-13.3 51-32.8 63.7-38.2 48.7 10.4 99.4 15.7 150.9 15.7 282.3 0 511.9-160.3 511.9-357.4 0.2-196.9-229.4-357.2-511.7-357.2z m0 648.9c-48.9 0-97-5.2-142.9-15.5-21.8-4.9-44.2 7.8-107.4 48.5-8.8 5.7-19.4 12.5-29.6 18.9 0.9-2.6 1.8-5.1 2.6-7.3 15.4-42.4 32.9-90.5-5.2-111.1C125.6 630.4 66 548.4 66 461.5 66 300.8 266.1 170 512.1 170s446.1 130.8 446.1 291.5c0 160.8-200.1 291.6-446.1 291.6z"
              />
            </svg>
            <div class="article_fun_num">{{ get_ArticleComment.length }}</div>
          </div>
        </div>
      </div>
      <!-- <link
        href="https://cdn.bootcss.com/github-markdown-css/2.10.0/github-markdown.min.css"
        rel="stylesheet"
      /> -->

      <div class="markdown-body" v-html="get_ArticlePage.html" />
      <h3 class="article_date_bottom">发布日期：{{ get_ArticlePage.date }}</h3>
    </div>

    <Comment
      class="toTheComment"
      id:id
      v-if="$store.state.isRouterAlive"
    ></Comment>
  </div>
</template>

<script>
import $ from 'jquery'
import { mapGetters, mapActions } from 'vuex'
import Comment from './Comment'
import axios from 'axios'
import VueCookies from 'vue-cookies'
export default {
  name: "Article",
  props: [
    'id'
  ],
  data () {
    return {
      // favorites: false,
    }
  },
  components: {
    Comment,
  },
  computed: {
    ...mapGetters(['get_ArticlePage', 'get_ArticleComment', 'get_Favorites']),
  },
  methods: {
    ...mapActions(['action_getArticlePage', 'action_clearArticle']),
    toComment () {
      // scrollTop获取元素顶部滚轮离顶部的长度
      var step = document.documentElement.scrollTop;
      var toTheComment = $('.toTheComment')[0].offsetTop
      var time = null;
      time = setInterval(function () {
        // 每次30px
        step += 30;
        if (step >= toTheComment) {
          clearInterval(time);
        }
        // 滚动到指定位置，scrollTo()接收两个参数：X，Y
        scrollTo(0, step);
        //这里时间太慢或者步长太大的话会不流畅，尽量快一点；当然也可以用JQ的动画去写，这样写可以不利用JQ，方便一点
      }, 10);
    },
    favorite () {
      if (VueCookies.isKey('token')) {
        var timer
        var isfavorites = !this.get_Favorites
        this.$store.commit('set_article_favorites', isfavorites)
        var token = VueCookies.get('token')
        var pageId = this.get_ArticlePage._id
        clearTimeout(timer);
        timer = setTimeout(() => {
          var itisfavorites = isfavorites
          axios
            .post('/user/collectionPage', { token, pageId, itisfavorites })
            .then((res) => {
              if (res.data.token) {
                VueCookies.set('token', res.data.token)
              } else {
                this.$store.commit('set_article_favorites', !itisfavorites)
                console.log(res.data)
              }
            })
            .catch((err) => {
              console.log(err)
            })
        }, 1000);
      } else {
        alert('请先登录')
      }

    },
  },
  created () {
    this.action_getArticlePage(this.id)
  },
  beforeDestroy () {
    this.action_clearArticle()
  }
}
</script>

<style scoped>
/* 代码高亮 */
@import url('../../../../node_modules/mavon-editor/dist/highlightjs/styles/github.min.css');
/* md的html样式 */
@import url('../../../../node_modules/mavon-editor/dist/markdown/github-markdown.min.css');
</style>